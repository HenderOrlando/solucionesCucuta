<!DOCTYPE html>
<html>
<head>
  <title>Soluciones Cúcuta - Login</title>
  <!-- Viewport mobile tag for sensible mobile support -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!--STYLES-->
  <link rel="stylesheet" href="/styles/uikit/uikit.almost-flat.min.css">
  <link rel="stylesheet" href="/styles/uikit/slideshow.almost-flat.min.css">
  <link rel="stylesheet" href="/styles/uikit/sticky.almost-flat.min.css">
  <link rel="stylesheet" href="/styles/uikit/dotnav.almost-flat.min.css">
  <link rel="stylesheet" href="/styles/angular-toastr.min.css">
  <link rel="stylesheet" href="/styles/fonts/font-awesome.min.css">
  <link rel="stylesheet" href="/styles/importer.css">
  <link rel="stylesheet" href="/styles/ng-animate.css">
  <link rel="stylesheet" href="/styles/uikit/dotnav.min.css">
  <link rel="stylesheet" href="/styles/uikit/slideshow.min.css">
  <link rel="stylesheet" href="/styles/uikit/sticky.min.css">
  <link rel="stylesheet" href="/styles/uikit/uikit.min.css">
  <!--STYLES END-->
  <style type="text/css">
    html, body{
      height: 100%;
    }
    .uk-navbar{
      position: fixed;
      width: 100%;
    }
  </style>
</head>
<body ng-app="loginModule" ng-controller="loginController" ng-cloak>
<!--TEMPLATES-->
<script type="text/javascript" src="/jst.js"></script>
<!--TEMPLATES END-->
  <div class="uk-vertical-align uk-text-center uk-height-1-1">
    <div class="uk-vertical-align-middle uk-width-5-6 uk-width-medium-2-6">
      <img alt="" src="/images/logo.png" class="uk-margin-bottom">
      <form ng-submit="submitLoginForm()" method="POST" class="uk-panel uk-panel-box uk-form">
        <div class="uk-form-row"
             ng-class="{'has-error':usuario.username.$invalid && usuario.username.$dirty}">
          <input type="text" class="uk-width-1-1 uk-form-large" placeholder="<%= __('nombre de usuario') %>" name="email" ng-model="usuario.username" required >
          <span class="help-block has-error" ng-if="usuario.username.$dirty">
            <span ng-show="usuario.username.$error.required"><%= __('nombre de usuario o email requeridos') %>.</span>
          </span>
        </div>
        <div class="control-group form-group col-md-6"
             ng-class="{'has-error':usuario.password.$invalid && usuario.password.$dirty}">
          <input type="password" class="uk-width-1-1 uk-form-large" placeholder="<%= __('clave') %>" name="password" id="password" required  ng-model="usuario.password">
          <span class="help-block has-error" ng-if="usuario.password.$dirty">
            <span ng-show="usuario.password.$error.required"><%= __('clave es requerida') %></span>
          </span>
        </div>

        <div class="uk-form-row">
          <button type="submit" class="uk-width-1-1 uk-button uk-button-primary uk-button-large">
            <span ng-show="!loginForm.loading"><%= __('entrar') %></span>
            <span ng-show="loginForm.loading" class="fa fa-spinner fa-spin"></span>
            <span ng-show="loginForm.loading"><%= __('entrar') %>...</span>
          </button>
        </div>
        <div class="uk-form-row uk-text-small">
          <label class="uk-float-left"><input type="checkbox"> <%= __('recordarme') %></label>
          <a href="/Password-forgot" class="uk-float-right uk-link uk-link-muted"><%= __('olvidó la clave') %>?</a>
        </div>
      </form>

    </div>
  </div>
</body>
<div id="javascripts">
  <!--SCRIPTS-->
  <script src="/js/dependencies/sails.io.js"></script>
  <script src="/js/dependencies/components/tinymce.min.js"></script>
  <script src="/js/dependencies/components/lodash.min.js"></script>
  <script src="/js/dependencies/components/lodash.undescore.min.js"></script>
  <script src="/js/dependencies/components/angular.js"></script>
  <script src="/js/dependencies/components/angular-animate.min.js"></script>
  <script src="/js/dependencies/components/angular-flow-standalone.min.js"></script>
  <script src="/js/dependencies/components/angular-sails.min.js"></script>
  <script src="/js/dependencies/components/angular-toastr.min.js"></script>
  <script src="/js/dependencies/components/angular-toastr.tpls.min.js"></script>
  <script src="/js/dependencies/components/angular-ui-router.min.js"></script>
  <script src="/js/dependencies/components/angular-ui-tinymce.js"></script>
  <script src="/js/dependencies/components/angular-ui-utils-ieshiv.min.js"></script>
  <script src="/js/dependencies/components/angular-ui-utils.min.js"></script>
  <script src="/js/dependencies/components/angular-utils-pagination-dir.js"></script>
  <script src="/js/dependencies/jquery-2.1.3.min.js"></script>
  <script src="/js/dependencies/lazysizes.min.js"></script>
  <script src="/js/uikit/core.min.js"></script>
  <script src="/js/uikit/utility.min.js"></script>
  <script src="/js/uikit/core-grid.min.js"></script>
  <script src="/js/uikit/slideshow.min.js"></script>
  <script src="/js/uikit/button.min.js"></script>
  <script src="/js/uikit/cover.min.js"></script>
  <script src="/js/uikit/dropdown.min.js"></script>
  <script src="/js/uikit/grid.min.js"></script>
  <script src="/js/uikit/modal.min.js"></script>
  <script src="/js/uikit/nav.min.js"></script>
  <script src="/js/uikit/offcanvas.min.js"></script>
  <script src="/js/uikit/scrollspy.min.js"></script>
  <script src="/js/uikit/slideshow-fx.min.js"></script>
  <script src="/js/uikit/smooth-scroll.min.js"></script>
  <script src="/js/uikit/sticky.min.js"></script>
  <script src="/js/uikit/touch.min.js"></script>
  <script src="/js/uikit/uikit.js"></script>
  <script src="/js/app.js"></script>
  <script src="/js/controllers.js"></script>
  <!--SCRIPTS END-->
  <script type="text/javascript">
    window.sails_locals = { _csrf: "<%= _csrf %>" };

    var app = angular.module("loginModule", ['ngSails', 'toastr']);

    //OPTIONAL! Set socket URL!
     app.config(['$sailsProvider', function ($sailsProvider) {
      $sailsProvider.url = 'http://localhost:1337/';
     }]);

    app.controller("loginController",
      function ($http, $scope, $sails, toastr, $timeout) {
        $scope.loginForm = {
          loading: false
        };
        var attrsToastr = {
          closeButton: true
        };
        $scope.submitLoginForm = function(){
          $scope.loginForm.loading = true;
          $scope.usuario._csrf = window.sails_locals._csrf;
          $http.post("/Login", $scope.usuario).success(function (data, status, headers, jwr) {
            showToastr(toastr, data.msgs);
            if(data.redirect && typeof data.redirect == 'string'){
              $timeout(function(){
                window.location = data.redirect;
              }, 4000);
            }
            return;
          }).error(function (data, status, headers, jwr) {
            for(var i in data.msgs){
              var msg = data.msgs[i];
              toastr.error(msg.content,msg.title);
            }
            return;
          }).finally(function (){
            $scope.loginForm.loading = false;
          });
        }
      }
    );
    function showToastr(toastr, msgs){
      for(var i in msgs){
        var msg = msgs[i];
        switch(msg.type){
          case 'error':
            toastr.error(msg.content,msg.title);
            break;
          case 'info':
            toastr.info(msg.content,msg.title);
            break;
          case 'warning':
            toastr.warning(msg.content,msg.title);
            break;
          case 'success':
            toastr.success(msg.content,msg.title);
            break;
        }
      }
    }
  </script>
</div>
